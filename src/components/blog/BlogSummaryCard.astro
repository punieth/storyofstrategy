---
import type { CollectionEntry } from 'astro:content';
import BrutalCard from '@components/layout/Brutalcard.astro';

interface Props {
  post: CollectionEntry<'blog'>;
  tone?: 'red' | 'orange' | 'yellow' | 'blue';
}

const { post, tone = 'yellow' } = Astro.props;
const enrichedFrontmatter = post.data as typeof post.data & {
  category?: string;
  readTime?: string;
  tags?: string[];
};
interface MotifColors {
  base: string;
  highlight: string;
  accent: string;
  border?: string;
  stripe?: string;
}
const motifPalette: Record<NonNullable<Props['tone']>, MotifColors> = {
  yellow: {
    base: '#fff7d6',
    highlight: '#ffe9a8',
    accent: '#facc15',
  },
  orange: {
    base: '#ffe6d4',
    highlight: '#ffcba0',
    accent: '#f97316',
  },
  blue: {
    base: '#e1edff',
    highlight: '#c7ddff',
    accent: '#2563eb',
  },
  red: {
    base: '#ffe0e0',
    highlight: '#ffbcbc',
    accent: '#ef4444',
  },
};
const companyThemes: Record<
  string,
  {
    name: string;
    tagline: string;
    palette?: Partial<MotifColors>;
  }
> = {
  'meesho-case-study': {
    name: 'Meesho',
    tagline: 'Social Commerce Trust Loop',
    palette: {
      base: '#fff0f8',
      highlight: '#ffd4ec',
      accent: '#f43397',
      border: '#9f1f68',
      stripe: '#d946ef',
    },
  },
  'razorpay-case-study': {
    name: 'Razorpay',
    tagline: 'Checkout Confidence Systems',
    palette: {
      base: '#e7f1ff',
      highlight: '#cfe2ff',
      accent: '#2b84ea',
      border: '#0b1f4b',
      stripe: '#0bc3e8',
    },
  },
  'notebooklm-case-study': {
    name: 'NotebookLM',
    tagline: 'AI Research Companion',
    palette: {
      base: '#f0f5ff',
      highlight: '#dfe6ff',
      accent: '#7c3aed',
      border: '#1e1b4b',
      stripe: '#38bdf8',
    },
  },
  'nobroker-prd': {
    name: 'NoBroker',
    tagline: 'Owner Performance Coach',
    palette: {
      base: '#fff5f2',
      highlight: '#ffd9cf',
      accent: '#f04438',
      border: '#9f1a11',
      stripe: '#fb923c',
    },
  },
};
const publishedOn = new Intl.DateTimeFormat('en-US', {
  month: 'short',
  day: 'numeric',
  year: 'numeric',
}).format(post.data.pubDate);
const category = enrichedFrontmatter.category ?? 'Product Strategy';
const readTime = enrichedFrontmatter.readTime ?? '5 min read';
const entryKey = post.id.split('/').pop() ?? post.id;
const companyTheme = companyThemes[entryKey];
const motifBase = motifPalette[tone];
const motif: MotifColors = {
  ...motifBase,
  ...(companyTheme?.palette ?? {}),
};
const companyName = companyTheme?.name ?? category;
const heroWord = companyName.toUpperCase();
const accentColor = motif.accent ?? '#111827';
const borderColor = motif.border ?? '#111827';
const baseTint = motif.base ?? '#ffffff';
const headerPattern =
  motif.stripe ??
  `repeating-linear-gradient(135deg, transparent 0 10px, ${accentColor} 10px 20px)`;
---
<BrutalCard
  tone={tone}
  color='#fbfaf5'
  borderColor='transparent'
  class='blog-summary group flex w-full flex-col rounded-xl border border-[#111827]/25 bg-white sm:rounded-2xl sm:border-0 sm:bg-[#fbfaf5] md:[aspect-ratio:1]'
  style='border-width: 1px;'
>
  <div
    class='flex h-full flex-col justify-between gap-4 border border-[#111827]/25 bg-white p-3 text-[#111827] transition-transform duration-150 ease-out hover:-translate-y-[4px] sm:border-[3px] sm:border-[#111827] sm:bg-white sm:p-6'
    style={`border-color: ${borderColor};`}
  >
    <header
      class='relative flex flex-row items-center justify-between gap-4 border-b border-[#111827]/20 py-3 sm:border-b-[3px] sm:flex-row sm:items-center sm:justify-between'
      style={`border-color: ${borderColor};`}
    >
      <div class='flex flex-row items-center gap-2 sm:flex-row sm:items-center sm:gap-3'>
        <span
          class='hidden sm:grid h-10 w-10 place-items-center rounded-lg border border-[#111827]/30 bg-white text-xs font-bold uppercase tracking-[0.3em] sm:rounded-none sm:border-[3px]'
          style={`background: ${baseTint}; border-color: ${borderColor};`}
        >
          ∎
        </span>
        <span
          class='dm-serif max-w-full text-balance font-black uppercase leading-[0.92] tracking-[0.16em] text-center sm:text-left'
          style={`font-size: clamp(1.4rem, 3.2vw, 2.1rem); word-break: break-word; overflow-wrap: anywhere;`}
        >
          {heroWord}
        </span>
      </div>
      <div
        class='h-6 sm:h-8 w-full flex-1 rounded-sm border border-[#111827]/25 sm:border-[3px]'
        style={`background: ${headerPattern}; border-color: ${borderColor};`}
        aria-hidden='true'
      ></div>
    </header>

    <div class='space-y-4'>
      <h3 class='dm-serif text-[1.55rem] font-black leading-[1.05] sm:text-[1.8rem]'>
        {post.data.title}
      </h3>
      <p class='poppins text-sm leading-relaxed text-[#111827]/80 md:text-[0.92rem]'>
        {post.data.description}
      </p>
    </div>

    <div class='flex flex-wrap items-center gap-3 border-t border-[#111827]/20 pt-3 text-[0.72rem] uppercase tracking-[0.22em] text-[#111827] sm:border-t-0 sm:pt-0 sm:gap-5'>
      <span class='inline-flex items-center gap-2 font-semibold'>
        <span class='block h-[3px] w-8 bg-[#111827]/70 sm:bg-[#111827]' aria-hidden='true'></span>
        Published {publishedOn}
      </span>
      <span class='inline-flex items-center gap-2 font-semibold'>
        <span class='block h-[3px] w-8 bg-[#111827]' aria-hidden='true'></span>
        Read Time {readTime}
      </span>
    </div>

    <a
      class='flex w-full items-center justify-between gap-3 self-stretch rounded-md bg-[#111827] px-4 py-2 text-[0.72rem] font-black uppercase tracking-[0.22em] text-white shadow-[5px_5px_0_rgba(17,24,39,0.28)] transition-transform duration-150 ease-out hover:-translate-y-[2px] hover:shadow-[8px_8px_0_rgba(17,24,39,0.26)] sm:w-auto sm:flex-nowrap sm:self-start sm:rounded-none sm:shadow-[9px_9px_0_rgba(17,24,39,0.38)] sm:hover:shadow-[12px_12px_0_rgba(17,24,39,0.3)]'
      href={`/blog/${post.id}/`}
    >
      <span>Open Case Study</span>
      <span
        class='grid h-6 w-6 shrink-0 place-items-center text-sm font-semibold text-[#111827] shadow-[4px_4px_0_rgba(17,24,39,0.35)]'
        style={`background-color: ${accentColor};`}
        aria-hidden='true'
      >
        ↗
      </span>
    </a>
  </div>
</BrutalCard>
