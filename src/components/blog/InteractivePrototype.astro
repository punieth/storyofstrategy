---
const {
  initialScreen = "list", // "list" | "detail" | "complete" | "delay" (if you add one)
  variant = "compact", // "compact" | "full"
  ...rest // forward arbitrary attrs like style=
} = Astro.props;
---

<div
  id="proto-root"
  data-initial={initialScreen}
  class={`relative mx-auto border-[#ffe0f1] bg-white border-[9px]
          shadow-[0_16px_40px_rgba(248,180,210,0.25)] aspect-[9/16]
          ${variant === "compact" ? "h-[640px] w-[320px]" : "h-[720px] w-[360px]"}`}
  style="--shell-r: 42px; --bezel: 9px; --screen-r: calc(var(--shell-r) - var(--bezel)); border-radius: var(--shell-r); overflow:hidden;"
>
  <section
    id="screen-orders-list"
    class="prototype-screen absolute inset-0 flex flex-col h-full"
  >
    <header
      class="px-5 py-3 bg-gradient-to-r from-white via-[#faf7ff] to-[#f4f1ff]
         border-b border-[#ebe6ff] flex flex-col items-center gap-1 flex-shrink-0
         shadow-[0_5px_12px_rgba(189,173,224,0.12)] text-[#463a6e]"
    >
      <span
        class="inline-flex h-7 w-7 items-center justify-center rounded-xl
           bg-[#efe9ff] text-[11px] font-semibold"
        >M</span
      >
      <div class="leading-tight text-center">
        <p
          class="text-[10px] uppercase tracking-[0.25em] text-[#7d60d1] font-semibold"
        >
          <!-- swap text here -->
          Orders
        </p>
        <h1 class="text-[14px] font-bold">
          <!-- swap text here -->
          Refund tracker
        </h1>
      </div>
    </header>

    <main
      class="p-4 space-y-3 flex-grow overflow-y-auto bg-gradient-to-b from-white via-[#fbf9ff] to-[#f7f2ff]"
    >
      <!-- Order (in progress) -->
      <button
        id="order-1234-card"
        class="w-full text-left bg-white p-4 rounded-xl border border-[#ece6ff] shadow-[0_6px_14px_rgba(149,114,255,0.12)] hover:shadow-[0_10px_18px_rgba(149,114,255,0.18)] transition-shadow"
      >
        <div class="flex items-start justify-between gap-3">
          <div class="min-w-0">
            <p class="font-semibold text-[13px] text-[#5b4a92] truncate">
              Kurti Set
            </p>
            <p class="text-[11px] text-[#8b6fa6]">Order #M-598-P9</p>
          </div>
          <div class="text-right">
            <span
              class="inline-flex items-center gap-2 text-[11px] font-semibold text-[#7c3aed]"
            >
              <span class="h-2 w-2 rounded-full bg-[#7c3aed]"></span>
              Refund in progress
            </span>
            <div class="text-[10px] text-[#8b6fa6] mt-1">ETA • 3 days</div>
          </div>
        </div>
        <div
          class="mt-3 pt-3 border-t border-[#f0eaff] flex items-center justify-between"
        >
          <span class="text-[11px] text-[#6f5f99]">Last updated • 2h ago</span>
          <span
            class="inline-flex items-center gap-1 text-[11px] text-[#7c3aed] font-semibold"
          >
            View status <span class="text-[14px] leading-none">›</span>
          </span>
        </div>
      </button>

      <!-- Order (completed) -->
      <div
        class="bg-white p-4 rounded-xl border border-[#ece6ff] shadow-[0_4px_10px_rgba(149,114,255,0.10)]"
      >
        <div class="flex items-start justify-between">
          <div>
            <p class="font-semibold text-[13px] text-[#5b4a92]">Bedsheet Set</p>
            <p class="text-[11px] text-[#8b6fa6]">Order #M-023-88</p>
          </div>
          <span
            class="inline-flex items-center gap-2 text-[11px] font-semibold text-[#16a34a]"
          >
            <span class="h-2 w-2 rounded-full bg-[#16a34a]"></span>
            Refunded
          </span>
        </div>
        <div class="mt-3 pt-3 border-t border-[#f0eaff]">
          <p class="text-[11px] font-semibold text-[#16a34a]">
            ₹699 credited • Sep 02
          </p>
        </div>
      </div>
    </main>
  </section>

  <section
    id="screen-order-detail"
    class="prototype-screen absolute inset-0 hidden flex-col h-full"
    data-state="happy"
  >
    <header
      class="relative px-5 py-3 bg-gradient-to-r from-white via-[#faf7ff] to-[#f4f1ff]
         border-b border-[#ebe6ff] flex flex-col items-center gap-1 flex-shrink-0
         shadow-[0_5px_12px_rgba(189,173,224,0.12)] text-[#463a6e]"
    >
      <button
        id="back-to-orders-btn"
        class="absolute left-4 top-1/2 -translate-y-1/2 inline-flex h-8 w-8 items-center justify-center rounded-full border border-[#e7e1ff] bg-white text-[#5b4a92] text-sm font-bold shadow-[0_3px_8px_rgba(180,154,220,0.12)]"
      >
        ‹
      </button>
      <span
        class="inline-flex h-7 w-7 items-center justify-center rounded-xl
           bg-[#efe9ff] text-[11px] font-semibold"
        >M</span
      >
      <div class="leading-tight text-center">
        <p
          class="text-[10px] uppercase tracking-[0.25em] text-[#7d60d1] font-semibold"
        >
          Refund tracker
        </p>
        <h1 class="text-[14px] font-bold">Order #M-598-P9</h1>
      </div>
    </header>

    <!-- ETA / Last updated -->
    <div
      class="px-4 py-2 bg-[#f7f3ff] text-[#5b4a92] text-[11px] border-b border-[#ede7ff] flex items-center justify-between flex-shrink-0"
    >
      <span class="font-semibold">Estimated credit: 3 days</span>
      <span class="text-[#8b6fa6]">Last updated • 2h ago</span>
    </div>

    <!-- Body (no scroll; all steps fit) -->
    <main
      class="p-4 flex flex-col flex-grow overflow-hidden bg-gradient-to-b from-white via-[#fff8fc] to-[#f5f0ff] gap-3"
    >
      <!-- Order summary -->
      <div
        class="p-3 rounded-xl bg-white/95 border border-[#ece6ff] shadow-[0_4px_10px_rgba(149,114,255,0.10)] flex-shrink-0"
      >
        <p class="font-semibold text-[13px] text-[#5b4a92]">Kurti Set</p>
        <p class="text-[11px] text-[#8b6fa6]">Cashfree payout • ₹899</p>
      </div>

      <ol class="flex-grow space-y-0">
        <!-- STEP 1 (no top segment; bottom = GREEN) -->
        <li class="flex items-center h-16">
          <div class="relative w-9 mr-3 flex-shrink-0 self-stretch h-full z-0">
            <!-- bottom only -->
            <div
              class="absolute top-1/2 bottom-0 left-1/2"
              style="transform:translateX(-1px); width:2px; background:#16a34a;"
            >
            </div>
            <div
              class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[22px] h-[22px] rounded-full bg-[#7c3aed] text-white text-[11px] leading-none flex items-center justify-center z-10"
            >
              ✓
            </div>
          </div>
          <div class="flex-1">
            <p class="font-semibold text-[13px] leading-tight text-[#463a6e]">
              Pickup Scheduled
            </p>
            <p class="text-[11px] text-[#6f5f99]">Sep 4–5 • Slot confirmed.</p>
          </div>
        </li>

        <!-- STEP 2 (top = GREEN, bottom = GREEN) -->
        <li class="flex items-center h-16">
          <div class="relative w-9 mr-3 flex-shrink-0 self-stretch h-full z-0">
            <div
              class="absolute top-0 bottom-[50%] left-1/2"
              style="transform:translateX(-1px); width:2px; background:#16a34a;"
            >
            </div>
            <div
              class="absolute top-[50%] bottom-0 left-1/2"
              style="transform:translateX(-1px); width:2px; background:#16a34a;"
            >
            </div>
            <div
              class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[22px] h-[22px] rounded-full bg-[#7c3aed] text-white text-[11px] leading-none flex items-center justify-center z-10"
            >
              ✓
            </div>
          </div>
          <div class="flex-1">
            <p class="font-semibold text-[13px] leading-tight text-[#463a6e]">
              Item Picked Up
            </p>
            <p class="text-[11px] text-[#6f5f99]">Sep 6 • In transit.</p>
          </div>
        </li>

        <!-- STEP 3 (top = GREEN, bottom = LAVENDER) -->
        <li class="flex items-center h-16">
          <div class="relative w-9 mr-3 flex-shrink-0 self-stretch h-full z-0">
            <div
              class="absolute top-0 bottom-[50%] left-1/2"
              style="transform:translateX(-1px); width:2px; background:#16a34a;"
            >
            </div>
            <div
              class="absolute top-[50%] bottom-0 left-1/2"
              style="transform:translateX(-1px); width:2px; background:#d6d0ec;"
            >
            </div>
            <!-- STEP 3 dot (stronger pink) -->
            <div
              class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2
         w-[22px] h-[22px] rounded-full bg-[#ec4899] border-2 border-[#db2777]
         text-white text-[12px] flex items-center justify-center leading-none z-10"
            >
              •
            </div>
          </div>
          <div class="flex-1">
            <p class="font-semibold text-[13px] leading-tight text-[#d053c8]">
              Checked & Approved
            </p>
            <p class="text-[11px] text-[#6f5f99]">
              Sep 7–9 • QC complete. Refund approved.
            </p>
          </div>
        </li>

        <!-- STEP 4 (top = LAVENDER, bottom = LAVENDER) -->
        <li class="flex items-center h-16">
          <div class="relative w-9 mr-3 flex-shrink-0 self-stretch h-full z-0">
            <div
              class="absolute top-0 bottom-[50%] left-1/2"
              style="transform:translateX(-1px); width:2px; background:#d6d0ec;"
            >
            </div>
            <div
              class="absolute top-[50%] bottom-0 left-1/2"
              style="transform:translateX(-1px); width:2px; background:#d6d0ec;"
            >
            </div>
            <div
              class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[22px] h-[22px] rounded-full bg-white border-2 border-[#d6d0ec] z-10"
            >
            </div>
          </div>
          <div class="flex-1">
            <p class="font-semibold text-[13px] leading-tight text-[#5b4a92]">
              Refund Sent to Bank
            </p>
            <p class="text-[11px] text-[#6f5f99]">
              UPI usually &lt;24h; cards 3–5 days.
            </p>
          </div>
        </li>

        <!-- STEP 5 (top = LAVENDER, no bottom segment) -->
        <li class="flex items-center h-16">
          <div class="relative w-9 mr-3 flex-shrink-0 self-stretch h-full z-0">
            <!-- top only -->
            <div
              class="absolute top-0 bottom-[50%] left-1/2"
              style="transform:translateX(-1px); width:2px; background:#d6d0ec;"
            >
            </div>
            <div
              class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[22px] h-[22px] rounded-full bg-white border-2 border-[#d6d0ec] z-10"
            >
            </div>
          </div>
          <div class="flex-1">
            <p class="font-semibold text-[13px] leading-tight text-[#5b4a92]">
              Amount Credited
            </p>
            <p class="text-[11px] text-[#6f5f99]">
              We’ll notify you when it lands.
            </p>
          </div>
        </li>
      </ol>
    </main>

    <!-- Footer (single primary, compact) -->
    <footer
      class="px-4 pb-3 pt-2 border-t border-[#ebe6ff] bg-white/95 flex-shrink-0"
    >
      <button
        id="remind-me-btn"
        class="w-full bg-[#7c3aed] text-white font-semibold py-2.5 rounded-lg text-[12px] shadow-[0_8px_16px_rgba(124,58,237,0.16)]"
      >
        Remind me when it’s credited
      </button>
    </footer>
  </section>
</div>

<script is:inline>
  (() => {
    function initNav() {
      const root = document.getElementById("proto-root");
      if (!root) return;
      const q = (sel) => root.querySelector(sel);
      const qa = (sel) => Array.from(root.querySelectorAll(sel));

      // Screens
      const screenList = q("#screen-orders-list");
      const screenDetail = q("#screen-order-detail"); // happy path
      const screenDelay = q("#screen-order-detail-delay"); // optional
      const screenComplete = q("#screen-complete"); // optional

      const show = (el) => {
        qa(".prototype-screen").forEach((s) => {
          s.classList.add("hidden");
          s.classList.remove("flex");
        });
        if (el) {
          el.classList.remove("hidden");
          el.classList.add("flex");
        }
      };

      // 1) Hard default to LIST first (prevents any late script from hijacking)
      show(screenList);

      // 2) THEN apply initial override if explicitly set and exists
      const start = (root.getAttribute("data-initial") || "list").toLowerCase();
      if (start === "detail" && screenDetail) show(screenDetail);
      if (start === "delay" && screenDelay) show(screenDelay);
      if (start === "complete" && screenComplete) show(screenComplete);
      // If start='list' or target missing, we stay on LIST.

      // 3) Click → go to detail (or delay if that’s the variant you included)
      const orderCard = q("#order-1234-card");
      if (orderCard)
        orderCard.addEventListener("click", () => {
          show(screenDetail || screenDelay || screenList);
        });

      // Status page footer button
      const remindBtn = q("#remind-me-btn");
      if (remindBtn)
        remindBtn.addEventListener("click", () => {
          remindBtn.textContent = "Reminder set ✓";
          remindBtn.disabled = true;
          remindBtn.classList.remove("bg-[#7c3aed]");
          remindBtn.classList.add("bg-[#a78bfa]");
        });

      // 4) Back buttons (include both IDs if you add delay later)
      [q("#back-to-orders-btn"), q("#back-to-orders-btn-delay")]
        .filter(Boolean)
        .forEach((btn) =>
          btn.addEventListener("click", () => show(screenList))
        );
    }

    // Ensure only ONE init runs
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initNav, { once: true });
    } else {
      initNav();
    }
  })();
</script>
