---
import type { CollectionEntry } from 'astro:content';
import BlogSummaryCard from './BlogSummaryCard.astro';

interface Props {
  posts: CollectionEntry<'blog'>[];
}

const { posts } = Astro.props;
const toneCycle: Array<'yellow' | 'orange' | 'blue' | 'red'> = [
  'yellow',
  'orange',
  'blue',
  'red',
];
---
<style>
  .gray-shadow {
    filter: drop-shadow(10px 10px 0 rgba(17,24,39,0.45));
  }
  @media (min-width: 640px) {
    .gray-shadow {
      filter: drop-shadow(22px 22px 0 rgba(17,24,39,0.45));
    }
  }
  .neo-rule {
    position: relative;
    display: block;
    height: 10px;
    margin-inline: auto;
    width: min(34rem, 94%);
    border: 3px solid #111827;
    background: repeating-linear-gradient(
      135deg,
      #111827 0 14px,
      #fbfaf5 14px 28px
    );
    box-shadow: 6px 6px 0 rgba(17, 24, 39, 0.24);
  }
  .neo-rule::after {
    content: '';
    position: absolute;
    inset: 2px -6px -6px 6px;
    border: 3px solid rgba(17, 24, 39, 0.85);
    pointer-events: none;
    mix-blend-mode: multiply;
  }
  /* iOS fallback */
  @supports (-webkit-touch-callout: none) {
    .gray-shadow {
      filter: none;
      box-shadow: 10px 10px 0 rgba(17,24,39,0.45);
    }
    @media (min-width: 640px) {
      .gray-shadow {
        box-shadow: 22px 22px 0 rgba(17,24,39,0.45);
      }
    }
  }
</style>
<section class='blog-feed-shell relative mx-auto w-full max-w-[92rem] px-0 pt-9 pb-14 sm:px-6 sm:pt-12 sm:pb-20 lg:px-10'>
  <div class='gray-shadow relative rounded-xl border-[4px] border-[#111827] bg-[#fbfaf5] lg:overflow-hidden'>
    <div
      class='pointer-events-none absolute inset-y-0 left-0 hidden w-[5.5rem] border-r-[4px] border-[#111827] bg-[#1f1720] lg:block'
      aria-hidden='true'
    >
      <div
        class='absolute inset-[10%_15%] border-[3px] border-white'
        style='background: repeating-linear-gradient(135deg, #fff3e6 0 16px, #07d474 16px 32px, #1f1720 32px 48px); mix-blend-mode: normal; opacity: 1;'
      ></div>
    </div>

    <div class='relative z-10 space-y-12 px-2 py-8 sm:space-y-16 sm:px-10 sm:py-12 lg:px-16 lg:py-16 lg:pl-[7.5rem]'>
      <div class='flex flex-col gap-10 lg:flex-row lg:items-end lg:justify-between'>
        <div class='space-y-4'>
          <span class='inline-flex w-fit items-center gap-3 border-[3px] border-[#111827] bg-white px-5 py-2 text-[0.75rem] font-black uppercase tracking-[0.32em] text-[#111827] shadow-[5px_5px_0_rgba(17,24,39,0.35)] sm:shadow-[10px_10px_0_rgba(17,24,39,0.35)]'>
            Field Notes
            <span class='block h-[10px] w-[10px] border-[3px] border-[#111827] bg-[#fff4e3]' aria-hidden='true'></span>
          </span>
          <h2 class='dm-serif text-[3rem] font-black uppercase leading-[0.95] tracking-[0.16em] text-[#111827] sm:text-[3.6rem]'>
            Product Stories
          </h2>
        </div>
        <p class='poppins max-w-2xl border-[3px] border-[#111827] bg-white px-6 py-5 text-sm leading-relaxed text-[#111827]/85 shadow-[6px_6px_0_rgba(17,24,39,0.32)] sm:shadow-[12px_12px_0_rgba(17,24,39,0.32)] lg:text-base'>
          Deep dives on how teams ship, scale, and sharpen product intuition. Each write-up is a distilled playbook with clear artefacts, tradeoffs, and forward experiments.
        </p>
      </div>

      <div class='py-4'>
        <div class='neo-rule' role='presentation'>
        </div>
      </div>

      <div class='sm:p-0'>
        <ul class='flex flex-col gap-8 px-4 md:grid md:auto-rows-fr md:grid-cols-2 md:gap-10 md:justify-items-stretch md:px-0 lg:pl-4'>
          {
            posts.map((post, index) => {
              const tone = toneCycle[index % toneCycle.length];
              return (
                <li class='list-none w-full'>
                  <BlogSummaryCard post={post} tone={tone} />
                </li>
              );
            })
          }
        </ul>
      </div>
    </div>
  </div>
</section>
